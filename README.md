# Análisis de la generación automatica de animaciones para agentes virtuales (NPC) basada en respuestas de Generative Pre-trained Transformers

##Overview
This project involves the generation of 3D animations using a custom GPT-4 model. The aim is to create realistic animations for humanoid Non-Player Characters (NPCs) based on textual descriptions. This repository contains scripts for converting animation data to and from JSON format, managing animation batches, and testing the generated animations in Unity.

##Features

All animations in this project and the code for translating animation objects to JSON files are to be used with the RIG found in Assets/FBX. To use a different RIG you would need to update the BodyPartsToMixamo and propertiesNames objects in the scripts to the new RIG body part names. You could also increase or reduce the body parts available by modifying this objects.

This project uses mainly 2 scripts, an editor one and a runtime one
-Runtime: LoadAnimFromJson.cs is located in Assets/Scripts. By dragging the RIG to the scene and creating an object for it you can add this script to the object. You must also add an Animator component and add the RigAnimatorController asset to the Animator, which you will find in Assets/FBX along with the RIG itself. With this script you can load a JSON animation to a RIG in runtime to be played and viewed. For this you will find a text input to specify the JSON path, you will also find a dropdown to select the version this file utilices. This versions are detailed below.

-Editor: AnimtionLoaderAndSaver.cs is located in Assets/Editor. This script generates an extra window that you can drag to your workspace in Unity. To acheve this go to the top left corner and search for the window tab, then look for "My Editor Window" or "GPT Anim Editor Window". In this window you will find the following functionality:
	*Single Anim to JSON generation: Select a file name and a version to generate a JSON animation from an existing animationClip.
	*Single JSON anim scoring: Select the version this JSON uses and it's path to calculate it's score.
	*Generate all versions dataset: This converts all example animations to JSON files. For each version it creates a folder in Assets/JSON-Datasets with the corresponding name. In this folder you 		will find the output animations in another folder and then another folder with files compressing this JSON animations into 2MB batches.
	*Quaternion to Euler angles tester: This is a tool that allows you to enter the Quaternion vector and see wht it's corresponding angle in Unity would be. This uses Unity's native functions to 		handle Quaternions (Vector3 eulerAngles = quaternion.eulerAngles)
	*Generate scores CSV for all versions: You will find a list of folders in Assets/GPTsFiles/Scoring belonging to each version. In this folders there are numbered JSON animations generated by 		corresponding custom GPT. You can generate as many animations as you want, either repeating prompts or using different ones. When generating scores for all this animations you will need to 		specify the max number of JSON files to concider. There must be at least that number of files in all version folders. Links to all versions custom GPT are found below. A CSV file will be 		the output in the path Assets/GPTsFiles/Scoring.
	*Generate scores CSV for FullDEG: In the path Assets/GPTsFiles/Scoring/PromptRepetition you will find a list of numbered folders. Each folder represents a different prompt used. Inside this 		folders you will find a list of numbered JSON files corresponding to a repetition of the folder's prompt. This function was created to score the winner version which was FullDEG, but could 		be adapted to test different version in the script AnimationLoaderAndSaver. When generating a scores CSV you will need to define the number of different prompts used and the number of 		repetitions in all folders. All folders must contain at least the the same amount of JSON files as the number of repetitions specified.
	*Angle checker: This was a tool used to test part of the scoring code. It is meant to tell you if an angle is withing the specified range regardless of it overlapping past 360 degrees or being 		negative.

##Version types:
-Full: This version replicates the way animations are stored natively in Unity, that means using quaternions and animating each axis separately as a different animation curve for the same body part.
-Compressed: Using vectors, this version reduces space used by joining together all axis into float arrays. Instead of using time-value pairs, parallel time-vector lists are used.
-Tokens: Time values are eliminated by sampling a 1 second animation into a given and equally separated amount of keyframes (sampling number)

The following versions use the same structure as the previous ones but replacing Quaternions with Euler angles
-FullDEG
-CompressedDEG
-TokensDEG

##custom GPT for each version
-Full: https://chatgpt.com/g/g-xaAR7YqA3-anim-full
-Compressed: https://chatgpt.com/g/g-J3i6e5G56-anim-compressed
-Tokens: https://chatgpt.com/g/g-aqpZjJ1Er-anim-tokens
-FullDEG: https://chatgpt.com/g/g-SsUS2zhUE-anim-fulldeg
-CompressedDEG: https://chatgpt.com/g/g-CX76d4PUK-anim-compresseddeg
-TokensDEG: https://chatgpt.com/g/g-U5NvpnFsI-anim-tokensdeg

##Datasets
- Original example animationclips: All the animations obtained as training data from mixamo are found in Assets/AnimDataset
- Converted example JSON animations: All original animations are found in all 6 versions at Assets/JSON-Datasets
- Generated JSON animations by customGPT: This are found in folder for each version at Assets/GPTsFiles/Scoring
- Prompts used: All prompts used for custom GPT generation are found in Assets/GPTsFiles/AnimPrompts.txt
- Setup prompts and templates: Folders for the prompts and templates used for each version of custom GPT are found in Assets/GPTsFiles/Prompts and Assets/GPTsFiles/Templates. You will also find the final 	Body structure used in Assets/GPTsFiles
- GPT development: A list of test animations created along the way of refining a the methodology for GPT to correctly genrate animations are found in Assets/GptGenerationTesting
- Setup prompt and template evolution: Multiple version of the setup prompt and template were made to reach working results. This evolution is found in Assets/GPTsFiles/PromptEvol
- Finetuning files: It was attempted to finetune GPT 3.5 for generating animations, although not further pursued, all files created for this purpose are found in Assets/Finetuning
- BodyMovements: The the ranges recorded for this rig are found in the Assets folder as BodyMovementsRanges.json and BodyMovementsRangesNormalized.json

	
